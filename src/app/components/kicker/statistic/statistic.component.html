<div class="stats-container">
  <mat-card>
    <mat-card-title>{{ 'stats.leaderboard' | translate }}</mat-card-title>
    <mat-tab-group mat-align-tabs="start">
      <mat-tab label="{{ 'stats.players' | translate }}">
        <mat-card-content>
          <app-leaderboard
            [dataSubject$]="playerTableData$"
            [displayedColumnsText]="displayedColumnsTranslationKeysPlayer"
            [displayedColumns]="displayedColumns"
            [activeColumn]="activeColumn"
            [sortDirection]="sortDirection"
            [disableClear]="disableClear"
            [filterHintText]="filterHintTranslationKey"
            [filterText]="filterTranslationKey"
            [pageSizeOptions]="pageSizeOptions"
            [receivedData]="receivedDataP"></app-leaderboard>
        </mat-card-content>
      </mat-tab>
      <mat-tab label="{{ 'stats.teams' | translate }}">
        <mat-card-content>
          <app-leaderboard
            [dataSubject$]="teamsTableData$"
            [displayedColumnsText]="displayedColumnsTranslationKeysTeam"
            [displayedColumns]="displayedColumns"
            [activeColumn]="activeColumn"
            [sortDirection]="sortDirection"
            [disableClear]="disableClear"
            [filterHintText]="filterHintTranslationKey"
            [filterText]="filterTranslationKey"
            [pageSizeOptions]="pageSizeOptions"
            [receivedData]="receivedDataT"></app-leaderboard>
        </mat-card-content>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
  <mat-card>
    <mat-card-title>{{
      'stats.playerAndTeamStats' | translate
    }}</mat-card-title>
    <mat-tab-group mat-align-tabs="start">
      <mat-tab label="{{ 'stats.players' | translate }}">
        <app-spinner *ngIf="!receivedDataP || !receivedDataM"></app-spinner>
        <p
          *ngIf="
            receivedDataP &&
            receivedDataM &&
            (!playerDataAvailable || !matchesDataAvailable)
          ">
          {{ 'info.noData' | translate }}
        </p>
        <div class="selections" *ngIf="allChartsReadyP">
          <mat-form-field appearance="fill">
            <mat-label>{{ 'common.player' | translate }}</mat-label>
            <mat-select
              [(value)]="selectedPlayer"
              (selectionChange)="updateYearsList(false)">
              <mat-option
                [value]="player.id"
                *ngFor="let player of playersWithMatches"
                >{{ player.name }}</mat-option
              >
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>{{ 'stats.year' | translate }}</mat-label>
            <mat-select
              [(value)]="selectedYearPlayer"
              (selectionChange)="updateMatchesData(false)">
              <mat-option [value]="year" *ngFor="let year of playerYearsList">{{
                year
              }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <div
            class="flex-container"
            [ngStyle]="{ display: allChartsReadyP ? 'block' : 'none' }">
            <div>
              <app-bar-line-chart
                (barLineChartIsReadyEvent)="checkIfChartsReady(0, $event)"
                [dataMap]="playersMap"
                [selectedData]="selectedPlayer"
                [selectedYear]="selectedYearPlayer"
                [months]="'months' | translate"
                [topBarLegendLabel]="'stats.wins' | translate"
                [lowerBarLegendLabel]="'stats.losses' | translate"
                [lineLegendLabel]="'stats.winRate' | translate"
                [allChartsReady]="allChartsReadyP"></app-bar-line-chart>
            </div>
            <div class="matches-chart">
              <app-matches-chart
                (matchesChartIsReadyEvent)="checkIfChartsReady(2, $event)"
                [chartData]="matchesChartDataPlayer"
                [legendLabel]="'app.matches' | translate"
                [months]="'months' | translate"
                [allChartsReady]="allChartsReadyP"></app-matches-chart>
            </div>
            <div>
              <app-result-doughnut-chart
                (doughnutChartIsReadyEvent)="checkIfChartsReady(1, $event)"
                [chartData]="doughnutDataPlayer"
                [winsLegendLabel]="'stats.wins' | translate"
                [lossesLegendLabel]="'stats.losses' | translate"
                [dominationsLegendLabel]="'stats.dominations' | translate"
                [defeatsLegendLabel]="'stats.defeats' | translate"
                [allChartsReady]="allChartsReadyP"></app-result-doughnut-chart>
            </div>
          </div>
        </div>
      </mat-tab>
      <mat-tab label="{{ 'stats.teams' | translate }}">
        <app-spinner *ngIf="!receivedDataT || !receivedDataM"></app-spinner>
        <p
          *ngIf="
            receivedDataT &&
            receivedDataM &&
            (!teamDataAvailable || !matchesDataAvailable)
          ">
          {{ 'info.noData' | translate }}
        </p>
        <div class="selections" *ngIf="allChartsReadyT">
          <mat-form-field appearance="fill">
            <mat-label>{{ 'common.team' | translate }}</mat-label>
            <mat-select
              [(value)]="selectedTeam"
              (selectionChange)="updateYearsList(true)">
              <mat-option
                [value]="team.id"
                *ngFor="let team of teamsWithMatches"
                >{{ team.name }}</mat-option
              >
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>{{ 'stats.year' | translate }}</mat-label>
            <mat-select
              [(value)]="selectedYearTeam"
              (selectionChange)="updateMatchesData(true)">
              <mat-option [value]="year" *ngFor="let year of teamYearsList">{{
                year
              }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div
          class="flex-container"
          [ngStyle]="{ display: allChartsReadyT ? 'block' : 'none' }">
          <div>
            <app-bar-line-chart
              (barLineChartIsReadyEvent)="checkIfChartsReady(3, $event)"
              [dataMap]="teamsMap"
              [selectedData]="selectedTeam"
              [selectedYear]="selectedYearTeam"
              [months]="'months' | translate"
              [topBarLegendLabel]="'stats.wins' | translate"
              [lowerBarLegendLabel]="'stats.losses' | translate"
              [lineLegendLabel]="'stats.winRate' | translate"
              [allChartsReady]="allChartsReadyT"></app-bar-line-chart>
          </div>
          <div class="matches-chart">
            <app-matches-chart
              (matchesChartIsReadyEvent)="checkIfChartsReady(5, $event)"
              [chartData]="matchesChartDataTeam"
              [legendLabel]="'app.matches' | translate"
              [months]="'months' | translate"
              [allChartsReady]="allChartsReadyT"></app-matches-chart>
          </div>
          <div>
            <app-result-doughnut-chart
              (doughnutChartIsReadyEvent)="checkIfChartsReady(4, $event)"
              [chartData]="doughnutDataTeam"
              [winsLegendLabel]="'stats.wins' | translate"
              [lossesLegendLabel]="'stats.losses' | translate"
              [dominationsLegendLabel]="'stats.dominations' | translate"
              [defeatsLegendLabel]="'stats.defeats' | translate"
              [allChartsReady]="allChartsReadyT"></app-result-doughnut-chart>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
  <mat-card>
    <mat-card-title>{{ 'stats.playtime' | translate }}</mat-card-title>
    <mat-card-content>
      <app-playtime-chart
        [months]="'months' | translate"
        [legendLabel]="'stats.playtimeLegend' | translate"
        [yScaleLabel]="'stats.minutes' | translate"
        [localeId]="'app.language.id' | translate"
        [datepickerLabelTexts]="datepickerLabelKeys"
        [datepickerHintTexts]="datepickerHintKeys"></app-playtime-chart>
    </mat-card-content>
  </mat-card>
</div>
